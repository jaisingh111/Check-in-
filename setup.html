<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Setup — Calendar Check‑In</title>
  <link rel="stylesheet" href="./styles.css" />
  <link rel="manifest" href="./manifest.json" />
  <meta name="theme-color" content="#0b0c10" />
</head>
<body>
  <header class="top">
    <div class="brand">
      <h1>Setup</h1>
      <p class="sub">Paste your Firebase config + choose a Room ID (no code editing)</p>
    </div>
  </header>

  <main class="wrap">
    <section class="card">
      <h2>1) Firebase Config</h2>
      <p class="muted">Firebase Console → Project settings → Your apps → Web app → copy the config object.</p>

      <label class="lbl" for="cfg">Paste config JSON</label>
      <textarea id="cfg" class="ta" placeholder='{"apiKey":"...","authDomain":"...","projectId":"...","storageBucket":"...","messagingSenderId":"...","appId":"..."}'></textarea>

      <h2 style="margin-top:16px;">2) Room ID</h2>
      <p class="muted">This is your private “secret key”. Use the SAME Room ID in the Firebase rules you paste.</p>

      <label class="lbl" for="room">Room ID</label>
      <input id="room" class="in" placeholder="couple-abcdef123456" />

      <div class="row">
        <button id="save" class="btn" type="button">Save settings</button>
        <a class="btn subtle" href="./index.html" style="text-decoration:none;">Go to app</a>
      </div>

      <p id="msg" class="muted" style="margin-top:10px;"></p>
    </section>
  </main>

  <script>
    const cfgEl = document.getElementById("cfg");
    const roomEl = document.getElementById("room");
    const msg = document.getElementById("msg");

    const existing = localStorage.getItem("cc_firebase_config");
    if (existing) cfgEl.value = existing;
    const existingRoom = localStorage.getItem("cc_room_id");
    if (existingRoom) roomEl.value = existingRoom;

    document.getElementById("save").addEventListener("click", () => {
      msg.textContent = "";
      try {
        const obj = JSON.parse(cfgEl.value.trim());
        const needed = ["apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId"];
        for (const k of needed) {
          if (!obj[k] || typeof obj[k] !== "string") throw new Error("Missing: " + k);
        }

        // Basic sanity checks to prevent the most common copy/paste mistakes.
        // authDomain should look like "<project-id>.firebaseapp.com"
        if (!/\.firebaseapp\.com$/i.test(obj.authDomain)) {
          throw new Error(
            "authDomain looks wrong. Copy the config from Firebase Console → Project settings → Your apps → Web app. " +
            "It should end with .firebaseapp.com"
          );
        }
        // storageBucket is usually "<project-id>.appspot.com" or "<project-id>.firebasestorage.app"
        if (!/(\.appspot\.com|\.firebasestorage\.app)$/i.test(obj.storageBucket)) {
          throw new Error(
            "storageBucket looks wrong. It should end with .appspot.com or .firebasestorage.app"
          );
        }

        const room = roomEl.value.trim();
        if (!room || room.length < 6) throw new Error("Room ID too short.");
        localStorage.setItem("cc_firebase_config", JSON.stringify(obj));
        localStorage.setItem("cc_room_id", room);
        msg.textContent = "Saved ✅ Now open the app.";
      } catch (e) {
        msg.textContent = "Could not save: " + (e.message || e);
      }
    });
  </script>
</body>
</html>
